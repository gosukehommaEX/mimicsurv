---
  title: "Getting Started with mimicsurv"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started with mimicsurv}
%\VignetteEngine{knitr::rmarkdown}
%\VignetteEncoding{UTF-8}
---
  
  ```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(mimicsurv)
```

## Introduction

The `mimicsurv` package provides tools for survival analysis from published Kaplan-Meier tables using the person-years method. This vignette demonstrates the basic usage of the package functions.

## Basic Survival Analysis

### Extracting Results from Kaplan-Meier Tables

The main function `extractfromKM()` estimates hazard rates and median survival time from published Kaplan-Meier data:
  
  ```{r basic-analysis}
# Example data from a hypothetical study
time_points <- c(0, 6, 12, 18, 24)
n_risk <- c(200, 165, 130, 95, 65)
n_censored <- c(0, 15, 35, 53, 65)

# Extract survival analysis results
result <- extractfromKM(time_points, n_risk, n_censored)

# View hazard table
print(result$hazard_table)

# View median survival time
cat("Median survival time:", result$median_survival, "months\n")
```

### Understanding the Results

The hazard table shows:
  
  - **interval**: Time intervals for hazard estimation
- **n_at_risk_start**: Number of patients at risk at the start of each interval
- **n_censored_interval**: Number of patients censored within each interval
- **n_events**: Number of events (estimated) within each interval
- **hazard_rate**: Estimated hazard rate (events per person-time)

## Mathematical Background

The package implements the person-years method with the following key concepts:
  
  ### Person-Time Calculation
  
  Person-time is calculated using the trapezoidal rule:
  
  $$\text{Person-time} = \frac{n_{\text{risk},i} + n_{\text{risk},i+1}}{2} \times (t_{i+1} - t_i)$$
  
  ### Hazard Rate Estimation
  
  Hazard rates are estimated as:
  
  $$\lambda_i = \frac{\text{Number of events}_i}{\text{Person-time}_i}$$
  
  ### Median Survival Time
  
  For piecewise exponential survival, the median is found where:
  
  $$S(t) = \exp\left(-\sum_{j=1}^{k} \lambda_j \Delta t_j\right) = 0.5$$
  
  ## Simulation and Validation
  
  ### Generating Simulated Data
  
  ```{r simulation}
# Define piecewise exponential parameters
time_points <- c(0, 6, 12, 18, 24)
hazard_rates <- c(0.05, 0.08, 0.12, 0.15)

# Simulate survival data
sim_data <- simPE(
  n = 200,
  time_points = time_points,
  hazard_rates = hazard_rates,
  max_time = 24,
  censoring_prob = 0.15
)

# Check event rate
table(sim_data$status)
```

### Creating Summary Tables

```{r summary-table}
# Create Kaplan-Meier style summary
km_summary <- summaryKM(sim_data, time_points)

print("Number at risk:")
print(km_summary$n_risk)

print("Cumulative censored:")
print(km_summary$n_censored_cumulative)
```

### Validation Study

```{r validation, eval=FALSE}
# Run validation study (small example)
validation_result <- validate_mimicsurv(
  true_time_points = time_points,
  true_hazard_rates = hazard_rates,
  sample_sizes = c(100, 200),
  n_simulations = 50,
  censoring_prob = 0.15
)

# View summary statistics
print(validation_result$summary_statistics)
```

## Advanced Usage

### Calculating True Median Survival

You can calculate the theoretical median survival time directly:
  
  ```{r true-median}
# Calculate true median for comparison
true_median <- getMediansurv(time_points, hazard_rates)
cat("True median survival:", round(true_median, 2), "months\n")
```

### Handling Different Scenarios

The package handles various scenarios:
  
  - **High censoring rates**: Appropriate for studies with substantial loss to follow-up
- **Multiple intervals**: Flexible number of time intervals
- **Missing median**: Returns NA when median survival is not reached

## Best Practices

1. **Data Quality**: Ensure input data is consistent (number at risk should decrease over time)
2. **Interval Selection**: Use meaningful time intervals that reflect clinical practice
3. **Validation**: Use simulation studies to validate results when possible
4. **Interpretation**: Consider the assumptions of piecewise exponential survival

## Conclusion

The `mimicsurv` package provides a comprehensive framework for extracting survival information from published Kaplan-Meier data. The combination of estimation and validation functions makes it a valuable tool for meta-analyses and secondary data analyses in survival research.
